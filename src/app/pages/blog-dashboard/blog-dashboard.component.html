<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>ููุญุฉ ุฅุฏุงุฑุฉ ุงููุฏููุฉ</h1>
    <p>ุฃุถู ููุดูุฑุงุช ุฌุฏูุฏุฉ ูููุฏููุฉ</p>

    <div class="user-info">
      <div class="user-details">
        <i class="fas fa-user-circle"></i>
        <div class="admin-info" *ngIf="adminUser">
          <span class="welcome-text">Welcome, {{ adminUser.username }}</span>
          <span class="user-role">{{ adminUser.role || "Admin" }}</span>
        </div>
        <span class="login-time">ุชู ุชุณุฌูู ุงูุฏุฎูู: {{ loginTime }}</span>
      </div>
    </div>

    <div class="header-actions">
      <button class="btn-secondary" (click)="goToBlog()" title="ุนุฑุถ ุงููุฏููุฉ">
        <i class="fas fa-newspaper"></i>
        ุนุฑุถ ุงููุฏููุฉ
      </button>
      <button
        class="btn-view-posts"
        (click)="openPostsPopup()"
        title="ุนุฑุถ ุงูููุดูุฑุงุช"
        *ngIf="existingPosts.length > 0"
      >
        <i class="fas fa-eye"></i>
        ุนุฑุถ ุงูููุดูุฑุงุช
        <span class="posts-count">({{ existingPosts.length }})</span>
      </button>
      <button class="btn-logout" (click)="logout()" title="ุชุณุฌูู ุงูุฎุฑูุฌ">
        <i class="fas fa-sign-out-alt"></i>
        ุชุณุฌูู ุงูุฎุฑูุฌ
      </button>
    </div>
  </div>

  <div class="dashboard-content">
    <div class="form-container">
      <form [formGroup]="blogForm" (ngSubmit)="onSubmit()" class="blog-form">
        <div class="form-section">
          <h3>ูุนูููุงุช ุงูููุดูุฑ ุงูุฃุณุงุณูุฉ</h3>

          <div class="form-group">
            <label for="title">ุนููุงู ุงูููุดูุฑ *</label>
            <input
              type="text"
              id="title"
              formControlName="title"
              placeholder="ุฃุฏุฎู ุนููุงู ุงูููุดูุฑ"
              [class.invalid]="isFieldInvalid('title')"
            />
            <div class="error-message" *ngIf="isFieldInvalid('title')">
              {{ getErrorMessage("title") }}
            </div>
          </div>

          <div class="form-group">
            <label for="excerpt">ููุฎุต ุงูููุดูุฑ *</label>
            <textarea
              id="excerpt"
              formControlName="excerpt"
              placeholder="ุฃุฏุฎู ููุฎุต ูุฎุชุตุฑ ููููุดูุฑ"
              rows="3"
              [class.invalid]="isFieldInvalid('excerpt')"
            ></textarea>
            <div class="error-message" *ngIf="isFieldInvalid('excerpt')">
              {{ getErrorMessage("excerpt") }}
            </div>
          </div>

          <div class="form-group">
            <label for="content">ูุญุชูู ุงูููุดูุฑ *</label>
            <textarea
              id="content"
              formControlName="content"
              placeholder="ุฃุฏุฎู ุงููุญุชูู ุงููุงูู ููููุดูุฑ"
              rows="8"
              [class.invalid]="isFieldInvalid('content')"
            ></textarea>
            <div class="error-message" *ngIf="isFieldInvalid('content')">
              {{ getErrorMessage("content") }}
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>ุชูุงุตูู ุฅุถุงููุฉ</h3>

          <div class="form-row">
            <div class="form-group">
              <label for="category">ุงููุฆุฉ *</label>
              <select
                id="category"
                formControlName="category"
                [class.invalid]="isFieldInvalid('category')"
              >
                <option value="">ุงุฎุชุฑ ุงููุฆุฉ</option>
                <option *ngFor="let cat of categories" [value]="cat">
                  {{ cat }}
                </option>
              </select>
              <div class="error-message" *ngIf="isFieldInvalid('category')">
                {{ getErrorMessage("category") }}
              </div>
            </div>

            <div class="form-group">
              <label for="readTime">ููุช ุงููุฑุงุกุฉ *</label>
              <input
                type="text"
                id="readTime"
                formControlName="readTime"
                placeholder="ูุซุงู: 5 ุฏูุงุฆู"
                [class.invalid]="isFieldInvalid('readTime')"
              />
              <div class="error-message" *ngIf="isFieldInvalid('readTime')">
                {{ getErrorMessage("readTime") }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="image">ุฑุงุจุท ุงูุตูุฑุฉ *</label>
            <input
              type="url"
              id="image"
              formControlName="image"
              placeholder="ุฃุฏุฎู ุฑุงุจุท ุงูุตูุฑุฉ"
              (input)="onImageUrlChange($event)"
              [class.invalid]="isFieldInvalid('image')"
            />
            <div class="error-message" *ngIf="isFieldInvalid('image')">
              {{ getErrorMessage("image") }}
            </div>
            <small class="help-text"
              >ูุฌุจ ุฃู ูููู ุงูุฑุงุจุท ุตุญูุญุงู ููุดูุฑ ุฅูู ุตูุฑุฉ</small
            >
          </div>

          <div class="form-group">
            <label for="tags">ุงูุนูุงูุงุช *</label>
            <input
              type="text"
              id="tags"
              formControlName="tags"
              placeholder="ุฃุฏุฎู ุงูุนูุงูุงุช ููุตููุฉ ุจููุงุตู"
              [class.invalid]="isFieldInvalid('tags')"
            />
            <div class="error-message" *ngIf="isFieldInvalid('tags')">
              {{ getErrorMessage("tags") }}
            </div>
            <small class="help-text">ูุซุงู: ุชูููุงุช, ุญูุงูุฉ, ุณูุงุฑุงุช, ุฌูุฏุฉ</small>
          </div>
        </div>

        <div class="form-section">
          <h3>ุชุญุณูู ูุญุฑูุงุช ุงูุจุญุซ (SEO)</h3>

          <div class="form-group">
            <label for="seoKeywords">ุงููููุงุช ุงูููุชุงุญูุฉ *</label>
            <input
              type="text"
              id="seoKeywords"
              formControlName="seoKeywords"
              placeholder="ุฃุฏุฎู ุงููููุงุช ุงูููุชุงุญูุฉ ููุตููุฉ ุจููุงุตู"
              [class.invalid]="isFieldInvalid('seoKeywords')"
            />
            <div class="error-message" *ngIf="isFieldInvalid('seoKeywords')">
              {{ getErrorMessage("seoKeywords") }}
            </div>
            <small class="help-text">ูุซุงู: ุชูููุงุช, ุญูุงูุฉ, ุณูุงุฑุงุช, ุฌูุฏุฉ</small>
          </div>

          <div class="form-group">
            <label for="seoDescription">ูุตู SEO *</label>
            <textarea
              id="seoDescription"
              formControlName="seoDescription"
              placeholder="ุฃุฏุฎู ูุตู ูุฎุชุตุฑ ููููุดูุฑ ูุชุญุณูู ูุญุฑูุงุช ุงูุจุญุซ"
              rows="3"
              [class.invalid]="isFieldInvalid('seoDescription')"
            ></textarea>
            <div class="error-message" *ngIf="isFieldInvalid('seoDescription')">
              {{ getErrorMessage("seoDescription") }}
            </div>
            <small class="help-text">ูุฌุจ ุฃู ูููู ุงููุตู ุจูู 50-160 ุญุฑู</small>
          </div>

          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="featured" id="featured" />
              <span class="checkmark"></span>
              ููุดูุฑ ูููุฒ
            </label>
            <small class="help-text"
              >ุงูููุดูุฑุงุช ุงููููุฒุฉ ุชุธูุฑ ูู ุฃุนูู ุงููุฏููุฉ</small
            >
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="isSubmitting">
            <i class="fas fa-plus" *ngIf="!isSubmitting"></i>
            <i class="fas fa-spinner fa-spin" *ngIf="isSubmitting"></i>
            {{ isSubmitting ? "ุฌุงุฑู ุงูุฅุถุงูุฉ..." : "ุฅุถุงูุฉ ุงูููุดูุฑ" }}
          </button>

          <button
            type="button"
            class="btn-secondary"
            (click)="blogForm.reset()"
            [disabled]="isSubmitting"
          >
            <i class="fas fa-undo"></i>
            ุฅุนุงุฏุฉ ุชุนููู
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Success/Error Messages -->
  <div class="message-container" *ngIf="message">
    <div class="message" [class]="'message-' + messageType">
      <i
        class="fas"
        [class]="
          messageType === 'success'
            ? 'fa-check-circle'
            : 'fa-exclamation-circle'
        "
      ></i>
      {{ message }}
    </div>
  </div>

  <!-- Posts Popup Modal -->
  <div
    class="posts-popup-overlay"
    *ngIf="showPostsPopup"
    (click)="closePostsPopup()"
  >
    <div class="posts-popup-content" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h3>ุนุฑุถ ุงูููุดูุฑุงุช</h3>
        <button class="popup-close" (click)="closePostsPopup()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="popup-controls">
        <div class="selection-controls">
          <button
            class="btn-select-all"
            (click)="selectAllPosts()"
            title="ุชุญุฏูุฏ ุฌููุน ุงูููุดูุฑุงุช"
            *ngIf="
              existingPosts.length > 0 &&
              selectedPosts.length < existingPosts.length
            "
          >
            <i class="fas fa-check-square"></i>
            ุชุญุฏูุฏ ุงููู
          </button>
          <button
            class="btn-deselect-all"
            (click)="deselectAllPosts()"
            title="ุฅูุบุงุก ุชุญุฏูุฏ ุฌููุน ุงูููุดูุฑุงุช"
            *ngIf="selectedPosts.length > 0"
          >
            <i class="fas fa-square"></i>
            ุฅูุบุงุก ุงูุชุญุฏูุฏ
          </button>
        </div>

        <div class="popup-actions">
          <button
            class="btn-delete-popup"
            (click)="deleteSelectedPosts()"
            title="ุญุฐู ุงูููุดูุฑุงุช ุงููุญุฏุฏุฉ"
            *ngIf="selectedPosts.length > 0"
            [attr.data-count]="selectedPosts.length"
          >
            <i class="fas fa-trash-alt"></i>
            ุญุฐู ุงูููุดูุฑุงุช ุงููุญุฏุฏุฉ
            <span class="selected-count" *ngIf="selectedPosts.length > 0">
              ({{ selectedPosts.length }})
            </span>
          </button>
        </div>
      </div>

      <div class="popup-posts-grid">
        <div
          class="popup-post-card"
          *ngFor="let post of existingPosts; trackBy: trackByPostId"
        >
          <div class="post-selection">
            <input
              type="checkbox"
              [id]="'popup-post-' + post.id"
              [checked]="selectedPosts.includes(post.id)"
              (change)="togglePostSelection(post.id)"
              class="post-checkbox"
            />
            <label [for]="'popup-post-' + post.id" class="post-checkbox-label">
              <i class="fas fa-check"></i>
            </label>
          </div>

          <div class="post-image">
            <img
              [src]="post.image"
              [alt]="post.title"
              onerror="this.src='assets/images/blog/default-post.jpg'"
            />
            <div class="post-badge" *ngIf="post.featured">
              <i class="fas fa-star"></i>
              ูููุฒ
            </div>
          </div>

          <div class="post-content">
            <h4 class="post-title">{{ post.title }}</h4>
            <p class="post-excerpt">{{ post.excerpt }}</p>

            <div class="post-meta">
              <span class="category">
                <i class="fas fa-tag"></i>
                {{ post.category }}
              </span>
              <span class="date">
                <i class="fas fa-calendar"></i>
                {{ getFormattedDate(post.date) }}
              </span>
              <span class="read-time">
                <i class="fas fa-clock"></i>
                {{ post.readTime }}
              </span>
            </div>

            <div class="post-tags">
              <span class="tag" *ngFor="let tag of post.tags">{{ tag }}</span>
            </div>
          </div>
        </div>

        <div class="no-posts" *ngIf="existingPosts.length === 0">
          <i class="fas fa-newspaper"></i>
          <h3>๐ ูุง ุชูุฌุฏ ููุดูุฑุงุช ุญุงููุงู</h3>
          <p>ูู ูุชู ุฅุถุงูุฉ ุฃู ููุดูุฑุงุช ุจุนุฏ</p>
          <small>ูู ุจุฅุถุงูุฉ ููุดูุฑ ุฌุฏูุฏ ูู ุงููููุฐุฌ ุฃุนูุงู</small>
        </div>
      </div>
    </div>
  </div>
</div>
